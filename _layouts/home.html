---
layout: base
---

<!-- ========================================
   홈페이지 레이아웃
   ======================================== -->

<div class="home">
  {{ content }}

  <!-- ========================================
     1. 포스트 목록 필터링
     ======================================== -->

  {%- if page.title == "Home" -%}
  <!-- 홈 페이지인 경우 모든 포스트 표시 -->
  {%- assign posts = site.posts -%}
  {%- else -%}
  <!-- 홈 페이지가 아닌 경우 해당 카테고리의 포스트만 표시 -->
  {%- assign page_category = page.title | downcase -%}
  {%- assign filtered_posts = site.categories[page_category] -%}
  {%- if page_category and filtered_posts -%}
  {%- assign posts = filtered_posts -%}
  {%- else -%}
  {%- if site.paginate -%}
  {%- assign posts = paginator.posts -%}
  {%- else -%}
  {%- assign posts = site.posts -%}
  {%- endif -%}
  {%- endif -%}
  {%- endif -%}

  <!-- ========================================
     2. 포스트 목록 렌더링
     ======================================== -->

  {%- if posts.size > 0 -%}
  {%- if page.list_title -%}
  <h2 class="post-list-heading">{{ page.list_title }}</h2>
  {%- endif -%}

  <ul class="post-list">
    {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
    {%- assign current_year = 0 -%}
    {%- assign current_month = 0 -%}
    {%- assign current_category = "" -%}

    {%- for post in posts -%}
    {%- unless post.hidden -%}
    {%- assign post_year = post.date | date: "%Y" -%}
    {%- assign post_month = post.date | date: " %-m" -%}
    {%- assign post_category = post.categories | first -%}



    <li>
      <!-- ========================================
                 2-1. 날짜 표시 (년월별 그룹화)
                 ======================================== -->

      <!-- 월 표시 로직 개선: 항상 표시하되 중복 제거 -->
      {%- if post_year != current_year -%}
      <!-- 새로운 년도인 경우 -->
      <span class="post-meta">{{ post_year }}.{{ post_month }}</span>
      {%- assign current_year = post_year -%}
      {%- assign current_month = post_month -%}
      {%- elsif post_month != current_month -%}
      <!-- 같은 년도지만 다른 월인 경우 -->
      <span class="post-meta">{{ post_month }}</span>
      {%- assign current_month = post_month -%}
      {%- else -%}
      <!-- 같은 년월인 경우 숨김 처리 -->
      <span class="post-meta" style="visibility: hidden;">{{ post_year }}.{{ post_month }}</span>
      {%- endif -%}

      <!-- ========================================
                 2-2. 카테고리 표시 (홈페이지에서만)
                 ======================================== -->
      {%- if page.title == "Home" and post_category -%}
      {%- if post_category != current_category -%}
      <span class="post-categories">{{ post_category | replace: '_', ' ' }}</span>
      {%- assign current_category = post_category -%}
      {%- else -%}
      <span class="post-categories" style="visibility: hidden;">{{ post_category | replace: '_', ' ' }}</span>
      {%- endif -%}
      {%- endif -%}


      <!-- ========================================
                 2-3. 포스트 링크 및 제목
                 ======================================== -->
      {%- assign post_slug = post.url | split: '/' | last | split: '.' | first -%}
      {%- assign is_short_post = false -%}

      <!-- 특정 짧은 글들 하드코딩 -->
      {%- if post_slug == 'experience-and-knowledge' or post_slug == '25-seasons' or post_slug == 'one-life' or
      post_slug == 'health-newbie' or post_slug == 'writing-model' -%}
      {%- assign is_short_post = true -%}
      {%- endif -%}

      <!-- post_metadata.json에서 확인 -->
      {%- assign post_data = site.data.post_metadata[post_slug] -%}
      {%- if post_data and post_data.is_short -%}
      {%- assign is_short_post = true -%}
      {%- endif -%}

      <a href="{{ post.url | relative_url }}" class="post-link" style="color: black;"
        data-post-url="{{ post.url | relative_url }}">
        {{ post.title | escape }}
        {%- if site.excerpt_length > 0 -%}
        {{ post.excerpt }}
        {%- endif -%}
        {%- if is_short_post -%}
        <span class="short-post-tag">짧은 글</span>
        {%- endif -%}
      </a>
    </li>
    {%- endunless -%}
    {%- endfor -%}
  </ul>

  <!-- ========================================
       3. 페이지네이션
       ======================================== -->

  {% if site.paginate %}
  <div class="pager">
    <ul class="pagination">
      {%- if paginator.previous_page %}
      <li>
        <a href="{{ paginator.previous_page_path | relative_url }}" class="previous-page"
          title="Go to Page {{ paginator.previous_page }}">
          {{ paginator.previous_page }}
        </a>
      </li>
      {%- else %}
      <li>
        <div class="pager-edge">•</div>
      </li>
      {%- endif %}

      <li>
        <div class="current-page">{{ paginator.page }}</div>
      </li>

      {%- if paginator.next_page %}
      <li>
        <a href="{{ paginator.next_page_path | relative_url }}" class="next-page"
          title="Go to Page {{ paginator.next_page }}">
          {{ paginator.next_page }}
        </a>
      </li>
      {%- else %}
      <li>
        <div class="pager-edge">•</div>
      </li>
      {%- endif %}
    </ul>
  </div>
  {%- endif %}
  {%- endif -%}
</div>

<script>
  // ========================================
  // 포스트 목록 검색 기능
  // ========================================

  document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.querySelector('.search-input');
    const postList = document.querySelector('.post-list');
    const postItems = document.querySelectorAll('.post-list li');

    // 분류 이름 줄이기 함수
    function shortenCategoryNames() {
      const categoryElements = document.querySelectorAll('.post-categories');
      categoryElements.forEach(element => {
        const originalText = element.textContent;
        let shortenedText = originalText;

        // 분류 이름 줄이기 규칙 - '효과적 모형'만 줄이기
        if (originalText === '효과적 모형') {
          shortenedText = '모형';
        }

        // 원본 텍스트를 data 속성에 저장하고 줄인 텍스트 표시
        element.setAttribute('data-original-category', originalText);
        element.textContent = shortenedText;
      });
    }

    // 검색 기능 (검색창이 있을 때만)
    if (searchInput && postList) {
      searchInput.addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase().trim();

        postItems.forEach(item => {
          const postLink = item.querySelector('.post-link');
          const postTitle = postLink ? postLink.textContent.toLowerCase() : '';
          const postUrl = postLink ? postLink.getAttribute('data-post-url') : '';

          if (searchTerm === '' || postTitle.includes(searchTerm) || postUrl.includes(searchTerm)) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });

        // 검색 결과가 없을 때 메시지 표시
        const visibleItems = Array.from(postItems).filter(item => item.style.display !== 'none');
        let noResultsMessage = document.querySelector('.no-results-message');

        if (visibleItems.length === 0 && searchTerm !== '') {
          if (!noResultsMessage) {
            noResultsMessage = document.createElement('div');
            noResultsMessage.className = 'no-results-message';
            noResultsMessage.textContent = '검색 결과가 없습니다.';
            noResultsMessage.style.cssText = 'text-align: center; color: #666; margin: 20px 0; font-style: italic;';
            postList.appendChild(noResultsMessage);
          }
        } else if (noResultsMessage) {
          noResultsMessage.remove();
        }
      });

      // 검색창 포커스 시 전체 선택
      searchInput.addEventListener('focus', function () {
        this.select();
      });

      // Enter 키로 검색 실행
      searchInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const firstVisibleItem = Array.from(postItems).find(item => item.style.display !== 'none');
          if (firstVisibleItem) {
            const link = firstVisibleItem.querySelector('.post-link');
            if (link) {
              window.location.href = link.href;
            }
          }
        }
      });
    }

    // 짧은 글 태그 표시/숨김 처리
    function handleShortPostTags() {
      postItems.forEach(item => {
        const postLink = item.querySelector('.post-link');
        const shortTag = item.querySelector('.short-post-tag');

        if (postLink && shortTag) {
          // 태그를 임시로 숨기고 텍스트만으로 너비 측정
          shortTag.style.display = 'none';
          const textOnlyWidth = postLink.scrollWidth;
          const availableWidth = postLink.offsetWidth;

          // 텍스트만으로도 잘렸다면 태그는 숨김
          if (textOnlyWidth > availableWidth) {
            shortTag.style.display = 'none';
          } else {
            // 태그를 다시 보이게 하고 전체 너비 측정
            shortTag.style.display = 'inline-block';
            const fullWidth = postLink.scrollWidth;

            // 태그 포함 전체가 잘렸다면 태그 숨김
            if (fullWidth > availableWidth) {
              shortTag.style.display = 'none';
            }
          }
        }
      });
    }

    // 디바운스 함수
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // 초기 실행 및 리사이즈 이벤트 (디바운스 적용)
    shortenCategoryNames(); // 분류 이름 줄이기 실행
    handleShortPostTags();
    window.addEventListener('resize', debounce(handleShortPostTags, 100));
  });
</script>
