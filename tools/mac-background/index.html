<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>맥 배경 16:9 + 메뉴바 검정 오버레이</title>
    <style>
        :root {
            --bar-h: 88;
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            margin: 0;
            padding: 24px;
            background: #0b0b0c;
            color: #e6e6e6;
        }

        h1 {
            font-size: 18px;
            margin: 0 0 12px;
        }

        .panel {
            display: grid;
            gap: 12px;
            grid-template-columns: 1fr;
            max-width: 980px;
            margin: auto;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .controls>* {
            background: #161616;
            border: 1px solid #292929;
            color: #e6e6e6;
            border-radius: 10px;
            padding: 10px 12px;
        }

        .controls input[type="number"] {
            width: 110px;
        }

        .controls select {
            min-width: 200px;
        }

        button.primary {
            background: #2a6cff;
            border-color: #2a6cff;
            cursor: pointer;
        }

        button.ghost {
            background: #161616;
            cursor: pointer;
        }

        .drop {
            border: 2px dashed #3a3a3a;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }

        .drop.drag {
            background: #171a24;
            border-color: #2a6cff;
        }

        .drop input {
            display: none;
        }

        .drop .hint {
            opacity: .8;
            font-size: 14px;
        }

        .preview-wrap {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #292929;
        }

        .preview {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000 center/cover no-repeat;
        }

        .bar {
            position: absolute;
            inset: 0 0 auto 0;
            height: calc(var(--bar-h) * 1px);
            background: #000;
            opacity: 1;
            pointer-events: none;
        }

        .img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .chips button {
            border-radius: 999px;
            padding: 6px 10px;
            border: 1px solid #3a3a3a;
        }

        small {
            opacity: .7;
        }
    </style>
</head>

<body>
    <div class="panel">
        <h1>이미지 → 16:9 배경 + 상단 메뉴바 검정</h1>

        <div class="controls">
            <label class="row">출력 해상도
                <select id="res">
                    <option value="3840x2160">3840×2160 (4K UHD)</option>
                    <option value="3360x2100">3360×2100 (13–14&quot; 맥북 비슷)</option>
                    <option value="3024x1964">3024×1964 (MBP 14&quot; 비슷, 16:10)</option>
                    <option value="2880x1800">2880×1800 (MBP 15/16 구형, 16:10)</option>
                    <option value="2560x1440">2560×1440 (QHD)</option>
                    <option value="1920x1080">1920×1080 (FHD)</option>
                </select>
            </label>

            <label class="row">메뉴바 높이(px)
                <input id="barH" type="number" min="0" step="1" value="88" />
                <span class="chips">
                    <button type="button" class="ghost" data-bar="64">64</button>
                    <button type="button" class="ghost" data-bar="72">72</button>
                    <button type="button" class="ghost" data-bar="88">88</button>
                    <button type="button" class="ghost" data-bar="96">96</button>
                </span>
            </label>

            <button id="download" class="primary">PNG 다운로드</button>
        </div>

        <label class="drop" id="drop">
            <input id="file" type="file" accept="image/*" />
            <div><strong>이미지를 드래그&드롭</strong> 하거나 클릭해서 선택하라.</div>
            <div class="hint">16:9로 꽉 채워지고, 위에 지정한 픽셀만큼 검정 오버레이가 얹혀진다.</div>
        </label>

        <div class="preview-wrap">
            <div class="preview" id="preview">
                <img id="img" class="img" alt="preview" />
                <div id="bar" class="bar"></div>
            </div>
        </div>

        <small>Tip: 맥 메뉴바는 디스플레이/스케일에 따라 달라져. 스크린샷 찍어서 픽셀 자로 재고 값 넣으면 정확하라.</small>
    </div>

    <script>
        (function () {
            const fileInput = document.getElementById('file');
            const drop = document.getElementById('drop');
            const imgEl = document.getElementById('img');
            const bar = document.getElementById('bar');
            const barH = document.getElementById('barH');
            const resSel = document.getElementById('res');
            const downloadBtn = document.getElementById('download');
            const preview = document.getElementById('preview');

            // 상태
            let imageBitmap = null;
            let naturalW = 0, naturalH = 0;

            // 바 높이 반영
            function applyBar() {
                const h = Math.max(0, parseInt(barH.value || '0', 10));
                document.documentElement.style.setProperty('--bar-h', h);
            }
            barH.addEventListener('input', applyBar);
            document.querySelectorAll('[data-bar]').forEach(b => {
                b.addEventListener('click', () => { barH.value = b.dataset.bar; applyBar(); });
            });
            applyBar();

            // 파일 로드
            function setImage(file) {
                if (!file) return;
                const url = URL.createObjectURL(file);
                imgEl.src = url;
                imgEl.onload = async () => {
                    // ImageBitmap으로 보관 (고속 드로잉)
                    imageBitmap = await createImageBitmap(file);
                    naturalW = imageBitmap.width;
                    naturalH = imageBitmap.height;
                    URL.revokeObjectURL(url);
                }
            }

            fileInput.addEventListener('change', e => setImage(e.target.files[0]));
            // 드롭
            ['dragenter', 'dragover'].forEach(ev => drop.addEventListener(ev, (e) => { e.preventDefault(); drop.classList.add('drag'); }));
            ['dragleave', 'drop'].forEach(ev => drop.addEventListener(ev, (e) => { e.preventDefault(); drop.classList.remove('drag'); }));
            drop.addEventListener('click', () => fileInput.click());
            drop.addEventListener('drop', (e) => {
                const f = e.dataTransfer.files?.[0];
                if (f && f.type.startsWith('image/')) setImage(f);
            });

            // 캔버스에 cover 방식으로 그리기
            function drawCover(ctx, img, cw, ch) {
                const iw = img.width, ih = img.height;
                const cr = cw / ch;        // canvas ratio
                const ir = iw / ih;        // image ratio
                let dw, dh, dx, dy;
                if (ir > cr) {
                    // 이미지가 더 가로로 김 -> 높이에 맞추고 좌우 잘라내기
                    dh = ch;
                    dw = Math.round(ch * ir);
                    dx = Math.round((cw - dw) / 2);
                    dy = 0;
                } else {
                    // 이미지가 더 세로로 김 -> 너비에 맞추고 상하 잘라내기
                    dw = cw;
                    dh = Math.round(cw / ir);
                    dx = 0;
                    dy = Math.round((ch - dh) / 2);
                }
                ctx.drawImage(img, dx, dy, dw, dh);
            }

            // 다운로드
            downloadBtn.addEventListener('click', async () => {
                if (!imageBitmap) {
                    alert('먼저 이미지를 올려라.');
                    return;
                }
                const [wStr, hStr] = resSel.value.split('x');
                const W = parseInt(wStr, 10), H = parseInt(hStr, 10);

                // 16:9가 아닐 수 있는 해상도는 16:9로 레터박싱 없이 캔버스 크기만 맞춤
                const CH = Math.round(W / 16 * 9);
                const canvas = document.createElement('canvas');
                canvas.width = W;
                canvas.height = CH;
                const ctx = canvas.getContext('2d');

                // 배경 검정
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, W, CH);

                // 이미지 cover
                drawCover(ctx, imageBitmap, W, CH);

                // 메뉴바 오버레이
                const barPx = Math.max(0, parseInt(barH.value || '0', 10));
                if (barPx > 0) {
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, W, barPx);
                }

                // 저장
                const url = canvas.toDataURL('image/png');
                const a = document.createElement('a');
                a.href = url;
                a.download = `wallpaper_${W}x${CH}_bar${barPx}.png`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
            });

        })();
    </script>
</body>

</html>
